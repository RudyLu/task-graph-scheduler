{
  "id":           "http://schemas.taskcluster.net/scheduler/v1/task-graph.json#",
  "$schema":      "http://json-schema.org/draft-04/schema#",
  "title":        "Task-Graph Definition",
  "description":  "Definition of a task-graph that can be scheduled",
  "type":         "object",
  "properties": {
    "scopes":           {"$const": "scopes"},
    "routing":          {"$const": "routing"},
    "tasks": {
      "title":                  "Tasks",
      "description":            "List of nodes in the task-graph, each featuring a task definition and scheduling preferences, such as number of _reruns_ to attempt.",
      "type":                   "array",
      "items": {
        "title":                "Task Node",
        "description":          "Representation of a tasks in the task-graph",
        "type":                 "object",
        "properties": {
          "taskId": {
            "title":            "Task Identifier",
            "description":      "Task identifier (`taskId`) for the task when submitted to the queue, also used in `requires` below. This must be formatted as a **slugid** that is a uuid encoded in url-safe base64 following [RFC 4648 sec. 5](http://tools.ietf.org/html/rfc4648#section-5)), but without `==` padding.",
            "type":             "string",
            "pattern":          {"$const": "slugid-pattern"}
          },
          "requires": {
            "title":            "Required tasks",
            "description":      "List of required `taskId`s",
            "type":             "array",
            "items": {
              "title":          "Required `taskId`",
              "description":    "`taskId` for task that is required to be _successfully completed_ before this task is scheduled.",
              "type":           "string",
              "pattern":        {"$const": "slugid-pattern"}
            }
          },
          "reruns": {
            "title":            "Re-runs",
            "description":      "Number of times to _rerun_ the task if it completed unsuccessfully. **Note**, this does not capture _retries_ due to infrastructure issues.",
            "type":             "integer",
            "minimum":          0,
            "maximum":          999
          },
          "task":               {"$ref": "http://schemas.taskcluster.net/queue/v1/task.json#"}
        },
        "required":             ["taskId", "requires", "reruns", "task"]
      }
    },
    "metadata": {
      "title":                  "Meta-data",
      "description":            "Required task metadata",
      "type":                   "object",
      "properties": {
        "name": {
          "title":              "Name",
          "description":        "Human readable name of task-graph",
          "type":               "string",
          "maxLength":          255
        },
        "description": {
          "title":              "Description",
          "description":        "Human readable description of task-graph, **explain** what it does!",
          "type":               "string",
          "maxLength":          32768
        },
        "owner": {
          "title":              "Owner",
          "description":        "E-mail of person who caused this task-graph, e.g. the person who did `hg push`",
          "type":               "string",
          "format":             "email",
          "maxLength":          255
        },
        "source": {
          "title":              "Source",
          "description":        "Link to source of this task-graph, should specify file, revision and repository",
          "type":               "string",
          "format":             "uri",
          "maxLength":          4096
        }
      },
      "additionalProperties":   false,
      "required": ["name", "description", "owner", "source"]
    },
    "tags": {
      "title":                  "Tags",
      "description":            "Arbitrary key-value tags (only strings limited to 4k)",
      "type":                   "object",
      "additionalProperties":   {"type": "string", "maxLength": 4096}
    }
  },
  "additionalProperties":       false,
  "required": ["scopes", "routing", "tasks", "metadata", "tags"]
}