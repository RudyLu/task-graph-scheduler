{
  "id":           "http://schemas.taskcluster.net/scheduler/v1/task-graph.json#",
  "$schema":      "http://json-schema.org/draft-04/schema#",
  "title":        "Task-Graph Definition",
  "description":  "Definition of a task-graph that can be scheduled",
  "type":               "object",
  "properties": {
    "version": {
      "title":          "Version",
      "description":    "Task-graph definition version",
      "enum":           ["0.2.0"]
    },
    "params": {
      "title":          "Parameters",
      "type":           "object",
      "description":    "Parameters that will be substituted into keys and strings of this object. This is useful for substituting repository, revision, owner, and other things like that. It is not recommended that this is used to modify task labels, nor is recursive substitution supported.",
      "additionalProperties": {
        "title":        "Parameter Value",
        "description":  "Value to be substituted in for a parameter",
        "type":         "string",
        "maxLength":    4096
      }
    },
    "routing":          {"$const": "routing"},
    "tasks": {
      "title":                  "Tasks",
      "description":            "Mapping from task-labels to task definition and scheduling preferences, such as number of _reruns_ to attempt.",
      "type":                   "object",
      "additionalProperties": {
        "title":                "Task",
        "description":          "Representation of a tasks in the task-graph",
        "type":                 "object",
        "properties": {
          "requires": {
            "title":            "Required tasks",
            "description":      "List of required task labels",
            "type":             "array",
            "items": {
              "title":          "Required task-label",
              "description":    "Label for task that is required to be _successfully completed_ before this task is scheduled.",
              "type":           "string",
              "maxLength":      255
            }
          },
          "reruns": {
            "title":            "Re-runs",
            "description":      "Number of times to _rerun_ the task if it completed unsuccessfully. **Note**, this does not capture _retries_ due to infrastructure issues.",
            "type":             "integer",
            "minimum":          0,
            "maximum":          999
          },
          "task":               {"$ref": "http://schemas.taskcluster.net/queue/v1/task.json#"}
        },
        "required":             ["requires", "reruns", "task"]
      }
    },
    "metadata": {
      "title":                  "Meta-data",
      "description":            "Required task metadata",
      "type":                   "object",
      "properties": {
        "name": {
          "title":              "Name",
          "description":        "Human readable name of task-graph",
          "type":               "string",
          "maxLength":          255
        },
        "description": {
          "title":              "Description",
          "description":        "Human readable description of task-graph, **explain** what it does!",
          "type":               "string",
          "maxLength":          32768
        },
        "owner": {
          "title":              "Owner",
          "description":        "E-mail of person who caused this task-graph, e.g. the person who did `hg push`",
          "type":               "string",
          "format":             "email",
          "maxLength":          255
        },
        "source": {
          "title":              "Source",
          "description":        "Link to source of this task-graph, should specify file, revision and repository",
          "type":               "string",
          "format":             "uri",
          "maxLength":          4096
        }
      },
      "additionalProperties":   false,
      "required": ["name", "description", "owner", "source"]
    },
    "tags": {
      "title":                  "Tags",
      "description":            "Arbitrary key-value tags (only strings limited to 4k)",
      "type":                   "object",
      "additionalProperties":   {"type": "string", "maxLength": 4096}
    }
  },
  "additionalProperties":       false,
  "required": ["version", "params", "routing", "tasks", "metadata", "tags"]
}